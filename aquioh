-- Carrega a Rayfield (SÓ FUNCIONA EM EXECUTOR, NÃO NO STUDIO)
local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
    Name = "Snap ESP - V6 Ultimate",
    LoadingTitle = "Carregando...",
    LoadingSubtitle = "by Snap",
    ConfigurationSaving = {
        Enabled = true,
        FolderName = "SnapESPConfig",
        FileName = "Config"
    },
    KeySystem = false,
})

local Tab = Window:CreateTab("Visuals", 4483362458)

-- Variáveis e Serviços
local Workspace = game:GetService("Workspace")
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer

local Config = {
    Animatronics = false,
    Names = false,
    Fuses = false
}
local ActiveESP = { Animatronics = {}, Fuses = {} }

-- Funções do ESP
local function CreateBillboard(target, name, color, checkFunc)
    local bg = Instance.new("BillboardGui")
    bg.Name = "ESP_Info"
    bg.Adornee = target
    bg.Size = UDim2.new(0, 200, 0, 50)
    bg.StudsOffset = Vector3.new(0, 3, 0)
    bg.AlwaysOnTop = true
    bg.Parent = target
    
    local tl = Instance.new("TextLabel", bg)
    tl.Size = UDim2.new(1,0,1,0)
    tl.BackgroundTransparency = 1
    tl.TextColor3 = color
    tl.TextStrokeTransparency = 0
    tl.Font = Enum.Font.GothamBold
    tl.TextSize = 14
    
    RunService.RenderStepped:Connect(function()
        if not target or not target.Parent or not checkFunc() then 
            bg.Enabled = false 
            return 
        end
        bg.Enabled = true
        local dist = (LocalPlayer.Character.HumanoidRootPart.Position - target.Position).Magnitude
        tl.Text = string.format("%s\n[%d m]", name, math.floor(dist))
    end)
end

local function AddAnimatronic(model)
    if ActiveESP.Animatronics[model] then return end
    
    local hl = Instance.new("Highlight")
    hl.FillColor = Color3.fromRGB(255, 0, 0)
    hl.Parent = model
    hl.Enabled = Config.Animatronics
    
    local root = model.PrimaryPart or model:FindFirstChild("HumanoidRootPart")
    if root then
        CreateBillboard(root, model.Name, Color3.fromRGB(255, 0, 0), function() return Config.Names end)
    end
    
    ActiveESP.Animatronics[model] = hl
end

local function AddFuse(tool)
    if ActiveESP.Fuses[tool] then return end
    local h = tool:FindFirstChild("Handle")
    if not h then return end
    
    local box = Instance.new("BoxHandleAdornment")
    box.Adornee = h
    box.Size = h.Size + Vector3.new(0.2,0.2,0.2)
    box.Color3 = Color3.fromRGB(0, 255, 0)
    box.AlwaysOnTop = true
    box.ZIndex = 5
    box.Transparency = 0.5
    box.Parent = h
    box.Visible = Config.Fuses
    
    CreateBillboard(h, "Fuse", Color3.fromRGB(0, 255, 0), function() return Config.Fuses end)
    ActiveESP.Fuses[tool] = box
end

-- Botões da Rayfield
Tab:CreateToggle({
    Name = "Ver Monstros",
    CurrentValue = false,
    Callback = function(v) 
        Config.Animatronics = v 
        for _, hl in pairs(ActiveESP.Animatronics) do hl.Enabled = v end
    end,
})

Tab:CreateToggle({
    Name = "Ver Nomes",
    CurrentValue = false,
    Callback = function(v) Config.Names = v end,
})

Tab:CreateToggle({
    Name = "Ver Fuses",
    CurrentValue = false,
    Callback = function(v) 
        Config.Fuses = v 
        for _, b in pairs(ActiveESP.Fuses) do b.Visible = v end
    end,
})

-- Inicialização
local function Init()
    -- Monstros
    local g = Workspace:FindFirstChild("Game")
    if g and g:FindFirstChild("Animatronics") then
        local folder = g.Animatronics:FindFirstChild("Animatronics") or g.Animatronics
        for _,v in pairs(folder:GetChildren()) do if v:IsA("Model") then AddAnimatronic(v) end end
        folder.ChildAdded:Connect(function(v) task.wait(0.5) if v:IsA("Model") then AddAnimatronic(v) end end)
    end
    
    -- Fuses (Loop Otimizado)
    task.spawn(function()
        while true do
            task.wait(2)
            for _,v in pairs(Workspace:GetDescendants()) do
                if v:IsA("Tool") and v.Name == "Fuse" then AddFuse(v) end
            end
        end
    end)
end

Init()
Rayfield:LoadConfiguration()
